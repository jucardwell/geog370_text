<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>11&nbsp; Doing Spatial Analysis in QGIS – GEOG370</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./other_tools.html" rel="next">
<link href="./spatial_analysis.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./doing_spatial_analysis.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Doing Spatial Analysis in QGIS</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GEOG370</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./politics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Politics and Potentials of GIS</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Core Spatial Concepts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">What is Geographic Data?</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Spatial Data Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./attributes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Understanding Attributes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./qgis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Working with Geographic Data in QGIS</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Managing Files</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./learning_qgis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">QGIS Basics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatial_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Spatial Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./doing_spatial_analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Doing Spatial Analysis in QGIS</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./other_tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Analysis Tools</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./making_maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Making Maps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setting-up-folder-structure" id="toc-setting-up-folder-structure" class="nav-link active" data-scroll-target="#setting-up-folder-structure"><span class="header-section-number">11.1</span> Setting up Folder Structure</a></li>
  <li><a href="#research-question-1" id="toc-research-question-1" class="nav-link" data-scroll-target="#research-question-1"><span class="header-section-number">11.2</span> Research Question 1</a>
  <ul class="collapse">
  <li><a href="#plain-language-summary" id="toc-plain-language-summary" class="nav-link" data-scroll-target="#plain-language-summary"><span class="header-section-number">11.2.1</span> Plain Language Summary</a></li>
  <li><a href="#download-data" id="toc-download-data" class="nav-link" data-scroll-target="#download-data"><span class="header-section-number">11.2.2</span> Download Data</a></li>
  <li><a href="#add-data" id="toc-add-data" class="nav-link" data-scroll-target="#add-data"><span class="header-section-number">11.2.3</span> Add Data</a></li>
  <li><a href="#select-by-attribute" id="toc-select-by-attribute" class="nav-link" data-scroll-target="#select-by-attribute"><span class="header-section-number">11.2.4</span> Select by Attribute</a></li>
  <li><a href="#reproject" id="toc-reproject" class="nav-link" data-scroll-target="#reproject"><span class="header-section-number">11.2.5</span> Reproject</a></li>
  <li><a href="#buffer" id="toc-buffer" class="nav-link" data-scroll-target="#buffer"><span class="header-section-number">11.2.6</span> Buffer</a></li>
  <li><a href="#intersect" id="toc-intersect" class="nav-link" data-scroll-target="#intersect"><span class="header-section-number">11.2.7</span> Intersect</a></li>
  <li><a href="#analyze-results" id="toc-analyze-results" class="nav-link" data-scroll-target="#analyze-results"><span class="header-section-number">11.2.8</span> Analyze Results</a></li>
  </ul></li>
  <li><a href="#research-question-2" id="toc-research-question-2" class="nav-link" data-scroll-target="#research-question-2"><span class="header-section-number">11.3</span> Research Question 2</a>
  <ul class="collapse">
  <li><a href="#plain-language-summary-1" id="toc-plain-language-summary-1" class="nav-link" data-scroll-target="#plain-language-summary-1"><span class="header-section-number">11.3.1</span> Plain Language Summary</a></li>
  <li><a href="#download-data-1" id="toc-download-data-1" class="nav-link" data-scroll-target="#download-data-1"><span class="header-section-number">11.3.2</span> Download Data</a></li>
  <li><a href="#add-data-1" id="toc-add-data-1" class="nav-link" data-scroll-target="#add-data-1"><span class="header-section-number">11.3.3</span> Add Data</a></li>
  <li><a href="#reproject-1" id="toc-reproject-1" class="nav-link" data-scroll-target="#reproject-1"><span class="header-section-number">11.3.4</span> Reproject</a></li>
  <li><a href="#clip" id="toc-clip" class="nav-link" data-scroll-target="#clip"><span class="header-section-number">11.3.5</span> Clip</a></li>
  <li><a href="#calculate-service-area" id="toc-calculate-service-area" class="nav-link" data-scroll-target="#calculate-service-area"><span class="header-section-number">11.3.6</span> Calculate Service Area</a></li>
  <li><a href="#spatial-join" id="toc-spatial-join" class="nav-link" data-scroll-target="#spatial-join"><span class="header-section-number">11.3.7</span> Spatial Join</a></li>
  <li><a href="#analyze-results-1" id="toc-analyze-results-1" class="nav-link" data-scroll-target="#analyze-results-1"><span class="header-section-number">11.3.8</span> Analyze Results</a></li>
  </ul></li>
  <li><a href="#research-question-3" id="toc-research-question-3" class="nav-link" data-scroll-target="#research-question-3"><span class="header-section-number">11.4</span> Research Question 3</a>
  <ul class="collapse">
  <li><a href="#plain-language-summary-2" id="toc-plain-language-summary-2" class="nav-link" data-scroll-target="#plain-language-summary-2"><span class="header-section-number">11.4.1</span> Plain Language Summary</a></li>
  <li><a href="#download-data-2" id="toc-download-data-2" class="nav-link" data-scroll-target="#download-data-2"><span class="header-section-number">11.4.2</span> Download Data</a></li>
  <li><a href="#add-data-2" id="toc-add-data-2" class="nav-link" data-scroll-target="#add-data-2"><span class="header-section-number">11.4.3</span> Add Data</a></li>
  <li><a href="#reclassify-raster" id="toc-reclassify-raster" class="nav-link" data-scroll-target="#reclassify-raster"><span class="header-section-number">11.4.4</span> Reclassify Raster</a></li>
  <li><a href="#zonal-statistics" id="toc-zonal-statistics" class="nav-link" data-scroll-target="#zonal-statistics"><span class="header-section-number">11.4.5</span> Zonal Statistics</a></li>
  <li><a href="#analyze-results-2" id="toc-analyze-results-2" class="nav-link" data-scroll-target="#analyze-results-2"><span class="header-section-number">11.4.6</span> Analyze Results</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Doing Spatial Analysis in QGIS</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This chapter introduces some of the most common tools used in spatial analysis and demonstrates how to apply them in QGIS. Spatial analysis often involves combining multiple tools in sequence to answer complex geographic questions. In this chapter, however, you are not expected to design those workflows yourself. Instead, you’ll follow structured steps to learn how individual tools work, what kinds of questions they help answer, and how to interpret the results they produce.</p>
<section id="setting-up-folder-structure" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="setting-up-folder-structure"><span class="header-section-number">11.1</span> Setting up Folder Structure</h2>
<p>You should use the following folder structure for Lab #2. Each research question should have its own project.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/folder_structure_lab2.png" class="img-fluid figure-img"></p>
<figcaption>Lab 2 Folder Setup</figcaption>
</figure>
</div>
</section>
<section id="research-question-1" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="research-question-1"><span class="header-section-number">11.2</span> Research Question 1</h2>
<p>Where is the intersection between vulnerable populations and existing permitted facilities that require a <a href="https://www.epa.gov/title-v-operating-permits/who-has-obtain-title-v-permit#:~:text=A%20major%20source%20has%20actual,are%20in%20non%2Dattainment">Major Air</a>) permit in North Carolina?</p>
<section id="plain-language-summary" class="level3" data-number="11.2.1">
<h3 data-number="11.2.1" class="anchored" data-anchor-id="plain-language-summary"><span class="header-section-number">11.2.1</span> Plain Language Summary</h3>
<p>For this research question, we’re looking for where two things overlap</p>
<ol type="1">
<li>Low-income communities (which we’re using as a stand-in for vulnerability)</li>
<li>Major air-polluting facilities (which require a special EPA permit)</li>
</ol>
<p>When we look at where polluting facilities and low-income communities are located together, we’re trying to understand whether some populations are more exposed to environmental risks than others.This kind of overlap can signal patterns of environmental injustice- situations where communities that already face social or economic challenges also have to deal with higher levels of pollution or health risks.</p>
<p>To analyze this research question, we will use the following steps:</p>
<ol type="1">
<li><em>Download and add the data:</em> We first need to load our census data and the locations of major air-polluting facilities</li>
<li><em>Find low-income areas:</em> We will use a <strong>select by attribute</strong> query to find only those census block groups that have a low median income</li>
<li><em>Prepare air quality data for analysis:</em> The air quality data begins in a GCS. Remember that for analysis purposes you generally want your data in a PCS. We will use the <strong>reproject</strong> tool to change the coordinate system.</li>
<li><em>Create zones around facilities:</em> The effects of pollution often extend beyond the boundaries of the facility itself. To identify nearby areas that could also be impacted, we’ll use a <strong>buffer</strong> to create a zone around each facility based on distance. This helps us include surrounding communities in our analysis.</li>
<li><em>Find overlap:</em> We want to find out which low-income communities are within the air pollution buffer zone. To do this, we will use the <strong>intersect</strong> tool.</li>
</ol>
</section>
<section id="download-data" class="level3" data-number="11.2.2">
<h3 data-number="11.2.2" class="anchored" data-anchor-id="download-data"><span class="header-section-number">11.2.2</span> <a href="https://drive.google.com/drive/folders/1AiEDyWe4eEemWIknTu1ZwtY4uy7U1vs3?usp=sharing">Download Data</a></h3>
<ul>
<li>2010 Census Block Group Median Household Income (from 2013 American Community Survey)</li>
<li>Current (June 2025) Major Air permits from <a href="https://www.epa.gov/frs/epa-frs-facilities-state-single-file-csv-download">EPA Geospatial Data</a></li>
</ul>
</section>
<section id="add-data" class="level3" data-number="11.2.3">
<h3 data-number="11.2.3" class="anchored" data-anchor-id="add-data"><span class="header-section-number">11.2.3</span> <a href="https://drive.google.com/file/d/1uFhPu0nxmjZjFK7m39FyeI5ZWNwUKJNO/view?usp=sharing">Add Data</a></h3>
<p>The polluting facilities data starts as a tabular file (rows and columns), so we will need to turn that into a spatial dataset using the latitude and longitude fields.</p>
<p>We’ll also need to add our processed census data, which we table joined in Lab #1. Remember to start a new project for this research question and save it to “lab_2/air_quality/”</p>
</section>
<section id="select-by-attribute" class="level3" data-number="11.2.4">
<h3 data-number="11.2.4" class="anchored" data-anchor-id="select-by-attribute"><span class="header-section-number">11.2.4</span> <a href="https://drive.google.com/file/d/1MZ1XbNwJqT6rJr-_8XU5hQzPgZENZWsB/view?usp=sharing">Select by Attribute</a></h3>
<p>We will then filter the census block group data so that we can identify only those that fulfill our low-income classification (median household income &lt; 4500). Export this selection as a new file into your “lab_2/air_quality/processed_data” folder.</p>
</section>
<section id="reproject" class="level3" data-number="11.2.5">
<h3 data-number="11.2.5" class="anchored" data-anchor-id="reproject"><span class="header-section-number">11.2.5</span> <a href="https://drive.google.com/file/d/1bHRpNRgo0Vj08QbHajc2pKoCYAe3jyQl/view?usp=sharing">Reproject</a></h3>
<p>The tabular dataset representing locations with major air quality permits is in a Geographic Coordinate System, not a projected one. Given that we are going to be doing distance-based analysis, we must reproject that data. We typically want to make sure that all our datasets are in the same projection, so we will reproject the data to match the projection of our census block group data (EPSG:2264). Export this reprojection as a new file into your “lab_2/air_quality/processed_data” folder.</p>
</section>
<section id="buffer" class="level3" data-number="11.2.6">
<h3 data-number="11.2.6" class="anchored" data-anchor-id="buffer"><span class="header-section-number">11.2.6</span> <a href="https://drive.google.com/file/d/1xNT_njunDmZP6bROD5mwMEDu-NZDqA6-/view?usp=sharing">Buffer</a></h3>
<p>A buffer will add a polygon around our facility points. This will allow us to identify areas that are within 1 mile of the facilities. Export this buffer as a new file into your “lab_2/air_quality/processed_data” folder.</p>
</section>
<section id="intersect" class="level3" data-number="11.2.7">
<h3 data-number="11.2.7" class="anchored" data-anchor-id="intersect"><span class="header-section-number">11.2.7</span> <a href="https://drive.google.com/file/d/1YF_nkzJV0zvX6zcwdTFlN8T31cTUrv_S/view?usp=sharing">Intersect</a></h3>
<p>To find the intersection between vulnerable populations and areas proximate to high polluting facilities, we will use the intersect tool. Intersects retain the attributes of both of the layers. Export this intersect as new file into your “lab_2/air_quality/processed_data” folder.</p>
</section>
<section id="analyze-results" class="level3" data-number="11.2.8">
<h3 data-number="11.2.8" class="anchored" data-anchor-id="analyze-results"><span class="header-section-number">11.2.8</span> Analyze Results</h3>
<p>Now that you’ve completed the spatial analysis, take time to explore what your map shows.</p>
<ul>
<li>What patterns do you see in the overlap between low-income areas and major air-polluting facilities?</li>
<li>Are there clusters, gaps, or surprises?</li>
<li>How did the spatial analysis tools you used help reveal those patterns?</li>
<li>Would you have been able to see the same information just by looking at the original data?</li>
</ul>
<section id="critical-questions-to-ask-about-the-data-and-methods" class="level4" data-number="11.2.8.1">
<h4 data-number="11.2.8.1" class="anchored" data-anchor-id="critical-questions-to-ask-about-the-data-and-methods"><span class="header-section-number">11.2.8.1</span> Critical Questions to Ask about the Data and Methods:</h4>
<ul>
<li>What assumptions are embedded in defining “vulnerable populations” based solely on median household income?</li>
<li>Why do we choose a 1-mile buffer, and what are the implications of this distance?</li>
<li>What is the source of the EPA permit data, and what might be missing?</li>
<li>This analysis uses 2010 block group data from the 2013 American Community Survey. What are the risks of using outdated demographic data for present-day decision-making?</li>
<li>What are the implications of using the census block group as the unit of analysis?</li>
</ul>
</section>
</section>
</section>
<section id="research-question-2" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="research-question-2"><span class="header-section-number">11.3</span> Research Question 2</h2>
<p>How many addresses are served by each park in Chapel Hill?</p>
<section id="plain-language-summary-1" class="level3" data-number="11.3.1">
<h3 data-number="11.3.1" class="anchored" data-anchor-id="plain-language-summary-1"><span class="header-section-number">11.3.1</span> Plain Language Summary</h3>
<p>In this research question, we’re exploring how accessible Chapel Hill’s parks are by looking at how many addresses fall within walking distance of each park. Access to parks is one part of understanding how well public amenities are distributed across the down. By analyzing the number of nearby addresses, we can see which parks are available to the highest number of people. This type of analysis also creates opportunity for further research on which areas <em>are not</em> served by existing parks and where new infrastructure might be needed.</p>
<p>To analyze this research question, we will use the following steps:</p>
<ol type="1">
<li><em>Download, add, and prepare the data</em>: We’ll load datasets for parks, addresses, and Chapel Hill boundaries. We’ll then <strong>reproject</strong> the parks layer to match the others.</li>
<li><em>Limit the area of focus:</em> The address dataset includes all addresses in Orange County. To isolate only the addresses that fall within Chapel Hill we will use the <strong>clip</strong> tool</li>
<li><em>Measure access to parks:</em> We will use a plug-in to create a <strong>service area</strong> around each park. This will show which areas are within a 10-minute walk from the park</li>
<li><em>Count addresses within each park’s service area</em>: We will use a <strong>spatial join</strong> to summarize how many addresses fall inside each service area.</li>
</ol>
</section>
<section id="download-data-1" class="level3" data-number="11.3.2">
<h3 data-number="11.3.2" class="anchored" data-anchor-id="download-data-1"><span class="header-section-number">11.3.2</span> <a href="https://drive.google.com/drive/folders/1ZPdJ9a26eqOSYpm3PIzZOcrgtWFaqJrB?usp=sharing">Download Data</a></h3>
<ul>
<li>Address points from <a href="https://www.orangecountync.gov/2057/Download-GIS-Data">Orange County GIS</a></li>
<li>Parks from <a href="https://opendata-townofchapelhill.hub.arcgis.com/search?q=parks">Chapel Hill Open Data</a></li>
<li>Chapel Hill boundaries from <a href="https://opendata-townofchapelhill.hub.arcgis.com/search?q=parks">Chapel Hill Open Data</a></li>
</ul>
</section>
<section id="add-data-1" class="level3" data-number="11.3.3">
<h3 data-number="11.3.3" class="anchored" data-anchor-id="add-data-1"><span class="header-section-number">11.3.3</span> Add Data</h3>
<p>Create a new project, saved in your “lab_2/park_access” folder. Add a basemap and the data to this project.</p>
</section>
<section id="reproject-1" class="level3" data-number="11.3.4">
<h3 data-number="11.3.4" class="anchored" data-anchor-id="reproject-1"><span class="header-section-number">11.3.4</span> Reproject</h3>
<p>As always, we want to make sure that our data shares the same coordinate system before beginning spatial analysis. You should notice that the address and Chapel Hill boundary datasets are in EPSG:2264 and the parks dataset is in EPSG:3857. These are both projected coordinate systems, however EPSG:2264 is a local projection built for North Carolina. EPSG:3857 is a more globally focused projection. Since EPSG:2264 would be slightly more accurate for North Carolina, reproject the parks to EPSG:2264. Make sure to save this reprojected file into your “lab_2/park_access/processed_data” folder.</p>
</section>
<section id="clip" class="level3" data-number="11.3.5">
<h3 data-number="11.3.5" class="anchored" data-anchor-id="clip"><span class="header-section-number">11.3.5</span> <a href="https://drive.google.com/file/d/1hu7CZzJRHemkV4PYUcd1DrR1wOB2Wigo/view?usp=sharing">Clip</a></h3>
<p>A clip will allow us to isolate only those addresses in Chapel Hill. Clip the addresses to the Chapel Hill boundary file. Save your output as a new file in your “lab_2/park_access/processed_data” folder.</p>
</section>
<section id="calculate-service-area" class="level3" data-number="11.3.6">
<h3 data-number="11.3.6" class="anchored" data-anchor-id="calculate-service-area"><span class="header-section-number">11.3.6</span> <a href="https://drive.google.com/file/d/1FSdIwj-8wy9IkAP2_WfA6c9sBD1rNbiD/view?usp=sharing">Calculate Service Area</a></h3>
<p>A service area represents the geographic region that can be reached from a location within a given travel distance or time, often used to model accessibility. Follow <a href="https://www.qgistutorials.com/en/docs/3/service_area_analysis.html">these instructions</a> to download the ORS plugin. Then calculate 10 minute isochrones from each park. Note that when you save the data (which is not in EPSG:2264), you can set the PCS of the output so it reprojects when it saves.&nbsp;</p>
</section>
<section id="spatial-join" class="level3" data-number="11.3.7">
<h3 data-number="11.3.7" class="anchored" data-anchor-id="spatial-join"><span class="header-section-number">11.3.7</span> <a href="https://drive.google.com/file/d/1f5sC-stNCu5kVeiGtJLp_KcnUFkuTpdR/view?usp=sharing">Spatial Join</a></h3>
<p>There is not a common “key” field between the service areas and our address data. Instead, the commonality between these two datasets is their spatial location. Therefore, to join these two datasets, we will use a spatial join. In this case, we will do a “join attributes by location (summary)” since we want to summarize the number of address points within each service area polygon. If we were interested in assigning each address point the name of the park whose service area it falls within we would use a regular spatial join (called “Join attributes by location” in QGIS). This type of join appends the attributes of one layer to another based on spatial relationships like intersection, containment, or proximity, but does not summarize counts or statistics.</p>
</section>
<section id="analyze-results-1" class="level3" data-number="11.3.8">
<h3 data-number="11.3.8" class="anchored" data-anchor-id="analyze-results-1"><span class="header-section-number">11.3.8</span> Analyze Results</h3>
<p>Now that you’ve completed the spatial analysis, take time to explore what your map shows.</p>
<ul>
<li>Which parks across Chapel Hill are serving the most people?</li>
<li>Are there any surprises?</li>
<li>How did the spatial analysis tools you used help reveal those patterns?</li>
<li>Would you have been able to see the same information just by looking at the original data?</li>
</ul>
<section id="critical-questions-to-ask-about-the-data-and-methods-1" class="level4" data-number="11.3.8.1">
<h4 data-number="11.3.8.1" class="anchored" data-anchor-id="critical-questions-to-ask-about-the-data-and-methods-1"><span class="header-section-number">11.3.8.1</span> Critical Questions to Ask about the Data and Methods:</h4>
<ul>
<li>What assumptions are we making when we define ‘served’ as being within a 10-minute isochrone from a park?</li>
<li>Are addresses a good stand-in for people?</li>
<li>Does a 10-minute walk on a map mean that it’s safe, comfortable, or desirable to walk there in real life?</li>
</ul>
</section>
</section>
</section>
<section id="research-question-3" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="research-question-3"><span class="header-section-number">11.4</span> Research Question 3</h2>
<p>Which parts of Buncombe County face greater wildfire risk based on land cover patterns?</p>
<section id="plain-language-summary-2" class="level3" data-number="11.4.1">
<h3 data-number="11.4.1" class="anchored" data-anchor-id="plain-language-summary-2"><span class="header-section-number">11.4.1</span> Plain Language Summary</h3>
<p>In this research question, we’re exploring how wildfire risk varies across Buncombe County zip codes based on the types of land cover (from a raster) in each area. Some land cover classes (like forest) are more likely to burn than others (like wetlands). By analyzing these patterns, we can better understand where wildfire vulnerability may be highest across the county.</p>
<p>To analyze this research question, we will use the following steps:</p>
<ol type="1">
<li><em>Download and add data</em>: We will add the land cover and zip code data to a new project</li>
<li><em>Assign risk to land cover classes:</em> The land cover raster has many different values. The values are numeric, but are actually representing categories of land cover. To look at risk, we will use the <strong>reclassify raster</strong> tool to translate each land cover class to a risk scale from 1 (low risk) to 5 (highest risk). This tool will create a new raster that changes each pixel value from its landcover class to its wildfire risk.</li>
<li><em>Summarize risk across zip codes</em>: The <strong>zonal statistics</strong> tool will allow us to summarize the raster across zones defined by a vector dataset (the zip code dataset). This means that we can calculate an average wildfire risk in each zip code.</li>
</ol>
</section>
<section id="download-data-2" class="level3" data-number="11.4.2">
<h3 data-number="11.4.2" class="anchored" data-anchor-id="download-data-2"><span class="header-section-number">11.4.2</span> <a href="https://drive.google.com/drive/folders/1rwdyyd9IdyjMN0AHoRJJuywjxFafNMOL?usp=sharing">Download Data</a></h3>
<ul>
<li><p>2023 National Land Cover Database <a href="https://www.mrlc.gov/data">MLRC</a></p></li>
<li><p>Buncombe County Zip Codes from <a href="https://data.buncombecounty.org/datasets/buncombe-county-zip-codes">Buncombe County Open Data</a></p></li>
</ul>
</section>
<section id="add-data-2" class="level3" data-number="11.4.3">
<h3 data-number="11.4.3" class="anchored" data-anchor-id="add-data-2"><span class="header-section-number">11.4.3</span> Add Data</h3>
<p>Create a new project, saved in your “lab_2/wildfire_risk” folder. Add a basemap and the data to this project. Change the symbology of the NLCD data to “Paletted/Unique values” and spend some time exploring the raster.</p>
</section>
<section id="reclassify-raster" class="level3" data-number="11.4.4">
<h3 data-number="11.4.4" class="anchored" data-anchor-id="reclassify-raster"><span class="header-section-number">11.4.4</span> <a href="https://drive.google.com/file/d/1b2P4NZLb3wLFYSS5wL-meIRqOgT3m1x2/view?usp=sharing">Reclassify Raster</a></h3>
<p>We will now reclassify the land cover raster onto a common risk scale from 1 (low risk) to 5 (highest risk). Reclassifying a raster means allows us to assign new values to ranges or categories of existing raster cell values.</p>
<p><strong>Note on coordinate system:</strong> The NLCD data is currently in a GCS, not a PCS. However, we will not reproject it. Reprojecting categorical rasters introduces a higher risk of distortion due to resampling. Since these rasters represent land <em>types</em> rather than continuous values, preserving the original cell values is most important.</p>
<p>Use the r.reclass tool and copy-paste the provided reclass rules for each raster. The output of each will be a numeric risk raster. Make sure you save this raster to “lab_2/wildfire_risk/processed_data”</p>
<table class="caption-top table">
<tbody>
<tr class="odd">
<td>Value</td>
<td>Output (Risk Score)</td>
<td>NLCD Class</td>
</tr>
<tr class="even">
<td>11</td>
<td>1</td>
<td>Open Water</td>
</tr>
<tr class="odd">
<td>21</td>
<td>2</td>
<td>Developed, Open Space</td>
</tr>
<tr class="even">
<td>22</td>
<td>2</td>
<td>Developed, Low Intensity</td>
</tr>
<tr class="odd">
<td>23</td>
<td>2</td>
<td>Developed, Medium Intensity</td>
</tr>
<tr class="even">
<td>24</td>
<td>1</td>
<td>Developed, High Intensity</td>
</tr>
<tr class="odd">
<td>31</td>
<td>3</td>
<td>Barren Land</td>
</tr>
<tr class="even">
<td>41</td>
<td>5</td>
<td>Deciduous Forest</td>
</tr>
<tr class="odd">
<td>42</td>
<td>5</td>
<td>Evergreen Forest</td>
</tr>
<tr class="even">
<td>43</td>
<td>5</td>
<td>Mixed Forest</td>
</tr>
<tr class="odd">
<td>52</td>
<td>4</td>
<td>Shrub/Scrub</td>
</tr>
<tr class="even">
<td>71</td>
<td>4</td>
<td>Grassland/Herbaceous</td>
</tr>
<tr class="odd">
<td>81</td>
<td>3</td>
<td>Pasture/Hay</td>
</tr>
<tr class="even">
<td>82</td>
<td>2</td>
<td>Cultivated Crops</td>
</tr>
<tr class="odd">
<td>90</td>
<td>2</td>
<td>Woody Wetlands</td>
</tr>
<tr class="even">
<td>95</td>
<td>2</td>
<td>Emergent Herbaceous Wetlands</td>
</tr>
</tbody>
</table>
<p>This is what to paste in the “Reclass rules text”&nbsp;</p>
<p>11 = 1</p>
<p>21 = 2</p>
<p>22 = 2</p>
<p>23 = 2</p>
<p>24 = 1</p>
<p>31 = 3</p>
<p>41 = 5</p>
<p>42 = 5</p>
<p>43 = 5</p>
<p>52 = 4</p>
<p>71 = 4</p>
<p>81 = 3</p>
<p>82 = 2</p>
<p>90 = 2</p>
<p>95 = 2</p>
<p>* = NULL</p>
</section>
<section id="zonal-statistics" class="level3" data-number="11.4.5">
<h3 data-number="11.4.5" class="anchored" data-anchor-id="zonal-statistics"><span class="header-section-number">11.4.5</span> <a href="https://drive.google.com/file/d/1AUJUe_8tveLC279rlt628V5-iLLetBez/view?usp=sharing">Zonal Statistics</a></h3>
<p>To summarize wildfire risk by ZIP code, we will use zonal statistics, which summarizes raster values (wildfire risk) based on vector boundaries (zip code boundaries). Calculate the mean value for each ZIP code. This gives an average vulnerability score (ranging roughly from 2 to 10) that reflects the average risk across each ZIP code. Make sure to save your zonal statistics output to “lab_2/wildfire_risk/processed_data”</p>
</section>
<section id="analyze-results-2" class="level3" data-number="11.4.6">
<h3 data-number="11.4.6" class="anchored" data-anchor-id="analyze-results-2"><span class="header-section-number">11.4.6</span> Analyze Results</h3>
<p>Now that you’ve completed the spatial analysis, take time to explore what your map shows.</p>
<ul>
<li>Which zip codes across Buncombe County have the highest land cover risk?</li>
<li>Are there any surprises?</li>
<li>How did the spatial analysis tools you used help reveal those patterns?</li>
<li>Would you have been able to see the same information just by looking at the original data?</li>
</ul>
<section id="critical-questions-to-ask-about-the-data-and-methods-2" class="level4" data-number="11.4.6.1">
<h4 data-number="11.4.6.1" class="anchored" data-anchor-id="critical-questions-to-ask-about-the-data-and-methods-2"><span class="header-section-number">11.4.6.1</span> Critical Questions to Ask about the Data and Methods:</h4>
<ul>
<li>How does the choice of administrative unit (ZIP codes) shape our understanding of vulnerability?</li>
<li>What important variables are missing from this model of wildfire vulnerability?</li>
<li>What are the limitations of using a strictly physical model for a hazard with complex social consequences?</li>
</ul>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./spatial_analysis.html" class="pagination-link" aria-label="Spatial Analysis">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Spatial Analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./other_tools.html" class="pagination-link" aria-label="Analysis Tools">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Analysis Tools</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>